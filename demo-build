#!/bin/bash

PATH="/usr/bin:/usr/sbin"

set -o errexit	# set -e
set -o nounset	# set -u

renice --priority 19 --pid $$ > /dev/null
ionice --class 3     --pid $$ > /dev/null

cd /var/named

KEYDIR=keys
ZONE=russon.org

mkdir -p $KEYDIR
rm -fr $KEYDIR/*

P=$(date -d "Jun 14 2014" "+%Y%m%d%H%M%S")
A=$(date -d "Jun 16 2014" "+%Y%m%d%H%M%S")
I=$(date -d "Dec 16 2014" "+%Y%m%d%H%M%S")
D=$(date -d "Dec 18 2014" "+%Y%m%d%H%M%S")

# Create a Key Signing Key (KSK)
/usr/sbin/dnssec-keygen -P $P -A $A -I $I -D $D -a NSEC3RSASHA1 -b 4096 -n ZONE -K $KEYDIR -f KSK $ZONE

P=$(date -d "Dec 14 2014" "+%Y%m%d%H%M%S")
A=$(date -d "Dec 16 2014" "+%Y%m%d%H%M%S")
I=$(date -d "Jun 16 2015" "+%Y%m%d%H%M%S")
D=$(date -d "Jun 18 2015" "+%Y%m%d%H%M%S")

# Create a Key Signing Key (KSK)
/usr/sbin/dnssec-keygen -P $P -A $A -I $I -D $D -a NSEC3RSASHA1 -b 4096 -n ZONE -K $KEYDIR -f KSK $ZONE

bin/dnssec-keygen russon.org 2014 09
bin/dnssec-keygen russon.org 2014 10
bin/dnssec-keygen russon.org 2014 11
bin/dnssec-keygen russon.org 2014 12
bin/dnssec-keygen russon.org 2015 01

ls -l $KEYDIR

